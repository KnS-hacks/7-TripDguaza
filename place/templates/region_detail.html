{% extends 'base.html' %}
{% load static %}
{% block main_area %}
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=36d28f49303019c33c6df68731ebcf13&libraries=services"></script>
<link rel="stylesheet" href="{% static 'main.css' %}">

<div class="container">
    <div class= "Contents">
        <div class="mainMap" id="map" style="width:60%; height: 720px;"></div>
        <!-- <script>
            var s = "{{'place.region'}}".replace('place.region', place.region)
            ps.keywordSearch(s, placesSearchCB);
        </script> -->
</div>

<script>
    var s = "{{region_name}}";
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
    mapOption = {
        center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
        level: 5 // 지도의 확대 레벨
    };  

    // 지도를 생성합니다    
    var map = new kakao.maps.Map(mapContainer, mapOption);

    $.getJSON("../../static/js/geo1.json", function(geojson) {
        let data = geojson.features;
        let coordinates = []; //좌표 저장 배열
        let name = ''; //행정구 이름

        $.each(data, function(index, val) {
            coordinates = val.geometry.coordinates;
            name = val.properties.CTP_KOR_NM;
            if (name == s) displayArea(coordinates, name);
            })
    })
    var polygons = [];

    function displayArea(coordinates, name) {
        $.each(coordinates, function(index, c) {
            let path = [];
            let points = [];
            $.each(c, function(index, coordinate) {
            let point = {};
            point.x = coordinate[1];
            point.y = coordinate[0];
            points.push(point);
            path.push(new kakao.maps.LatLng(coordinate[1], coordinate[0]));
            })
            let polygon = new kakao.maps.Polygon({
            map: map,
            path: path, // 그려질 다각형의 좌표 배열입니다
            strokeWeight: 2, // 선의 두께입니다
            strokeColor: '#004c80', // 선의 색깔입니다
            strokeOpacity: 0.8, // 선의 불투명도 입니다 1에서 0 사이의 값이며 0에 가까울수록 투명합니다
            strokeStyle: 'solid', // 선의 스타일입니다
            fillColor: '#fff', // 채우기 색깔입니다
            fillOpacity: 0.7, // 채우기 불투명도 입니다
            });
            polygons.push(polygon);
        })
    }

    // 장소 검색 객체를 생성합니다
    var ps = new kakao.maps.services.Places(); 

    // 키워드로 장소를 검색합니다
    ps.keywordSearch(s, placesSearchCB); 

    // 키워드 검색 완료 시 호출되는 콜백함수 입니다
    function placesSearchCB (data, status, pagination) {
        if (status === kakao.maps.services.Status.OK) {

            // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
            // LatLngBounds 객체에 좌표를 추가합니다
            var bounds = new kakao.maps.LatLngBounds();

            for (var i=0; i<data.length; i++) {
                // displayMarker(data[i]);    
                bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
            }       

            // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
            map.setBounds(bounds);
        } 
    }
</script>
{% endblock %}